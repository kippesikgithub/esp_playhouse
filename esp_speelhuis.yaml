esphome:
  name: esp-speelhuis
  friendly_name: esp-speelhuis

esp32:
  board: esp32-s2-saola-1
  framework:
    type: arduino

# Enable logging
logger:

# Enable Home Assistant API
api:

ota:

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Esp-Speelhuis Fallback Hotspot"
    password: "wachtwoord"

captive_portal:

sensor:
  - platform: adc
    id: esp_speelhuis_battery_voltage 
    pin: GPIO4
    attenuation: auto
    name: Battery Voltage
    update_interval: 1s
    accuracy_decimals: 2
    filters:
      - multiply: 2
    #use moving median to smooth spikes
      - median:
          window_size: 10
          send_every: 10
          send_first_at: 10
      - delta: 0.01 #Only send values to HA if they change 
      - throttle: 30s #Limit values sent to Ha
#Convert the Voltage to a battery  level (%)
  - platform: copy
    source_id: esp_speelhuis_battery_voltage
    id: esp_speelhuis_battery_level
    icon: "mdi:battery"
    name: Battery Level
    unit_of_measurement: '%'
    accuracy_decimals: 2
    filters:
      - calibrate_linear:
      # Map from voltage to Battery level
          - 3.1 -> 0
          - 4.16 -> 100
      #Handle/cap boundaries
      - lambda: |
          if (x < 0) return 0; 
          else if (x > 100) return 100;
          else return (x);
      - delta: 0.5 #Only send values to HA if they change 
      - throttle: 30s #Limit values sent to Ha

switch:
  - platform: gpio
    pin: GPIO12
    name: "Speelhuis waterpomp" 
    id: esp_speelhuis_speelhuis_waterpomp

light:
  - platform: neopixelbus
    type: GRB
    variant: WS2811
    pin: GPIO8
    num_leds: 5
    name: "Speelhuis ledstrip"
    id: esp_speelhuis_speelhuis_ledstrip
